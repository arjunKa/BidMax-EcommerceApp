<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="styles/ItemStyle.css">
	<title>Item Details</title>

</head>

<script>
	function getQueryParam(param) {
		var urlParams = new URLSearchParams(window.location.search);
		return urlParams.get(param);
	}
	// Fetch the username from the server using AJAX
	function fetchUsername() {
		var xhr = new XMLHttpRequest();
		xhr.onreadystatechange = function () {
			if (xhr.readyState == 4 && xhr.status == 200) {
				// Update the username display element
				document.getElementById("usernameDisplay").innerText = "User Id: " + xhr.responseText;
			}
		};
		xhr.open("GET", "GetUsernameServlet", true);
		xhr.send();
	}

	window.onload = function () {
		toggleNumberInput();
		var elem = document.getElementById("itemId");
		elem.value = getQueryParam("id");
		var elem = document.getElementById("auctionTypeHidden");
		elem.value = getQueryParam("auctionType");
		console.log(elem.value);
		fetchUsername();

	};

</script>

<body>

	<header>
		<h1>BEZOS</h1>
		<!-- Add an element to display the username -->
		<p id="usernameDisplay"></p>
		<button onclick="window.location.href='Search.html'" class="back-button">BACK</button>
	</header>

	<div class="flex-container">
		<h1>Item Details</h1>
	</div>
	<div class="main">
		<div class="item-details">
			<p><strong>Item Name:</strong> <span id="itemName"></span></p>
			<p><strong>Current Price:</strong> <span id="currentPrice"></span></p>
			<p><strong>Auction Type:</strong> <span id="auctionType"></span></p>
			<p><strong>Remaining Time:</strong> <span id="remainingTime"></span></p>
			<p><strong>Description:</strong> <span id="description"></span></p>
			<p><strong>Shipping Price:</strong> <span id="shippingPrice"></span></p>

			<form action="BidServlet" method="post" autocomplete="off">
				<label for="numberInput">Bid Amount:</label>
				<input type="number" id="numberInput" name="amount" pattern="^\d*(\.\d{0,2})?$" step="any" min="0">
				<input type="hidden" id="itemId" name="Item_id" value="">
				<input type="hidden" id="auctionTypeHidden" name="auctionTypeHidden" value="">
				<input type="submit" value="Bid">
			</form>

		</div>
	</div>

	<script>
		// Function to get query parameters from the URL
		function getQueryParam(param) {
			var urlParams = new URLSearchParams(window.location.search);
			return urlParams.get(param);
		}

		// Set item details from query parameters
		document.getElementById("itemName").innerText = getQueryParam("itemName");
		document.getElementById("currentPrice").innerText = getQueryParam("currentPrice");
		document.getElementById("auctionType").innerText = getQueryParam("auctionType");
		document.getElementById("remainingTime").innerText = getQueryParam("remainingTime");
		document.getElementById("shippingPrice").innerText = getQueryParam("shipping");
		document.getElementById("description").innerText = getQueryParam("description");

		// Fetch additional details from the server
		fetchDetails(getQueryParam("itemName"));

		function fetchDetails(itemName) {
			// Perform an AJAX request to the server to get additional details
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function () {
				if (this.readyState == 4 && this.status == 200) {
					// Update the HTML content with the received details
					var details = JSON.parse(this.responseText);
					document.getElementById("description").innerText = details.description;
					document.getElementById("shippingPrice").innerText = details.shippingPrice;
				}
			};
			xhttp.open("GET", "getDetails?itemName=" + itemName, true);
			xhttp.send();
		}

		function handlePayment() {
			// Implement your payment logic here
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function () {

				//xhttp.open("POST", "BidServlet?itemId=" + itemName, true);
				//xhttp.send();
				//alert("Payment logic goes here!");
			}
		}

		// Function to hide or show the number input based on the session value
		function toggleNumberInput() {
			// Assuming you have a session variable named 'showNumberInput'
			var showNumberInput = getQueryParam("auctionType");

			// Get the number input element
			var numberInput = document.getElementById('numberInput');

			// Toggle visibility based on the session value
			numberInput.style.display = showNumberInput === 'forward' ? 'block' : 'none';
		}

		// Function to be called when the form is submitted
		function onSubmit() {
			// Get the form element
			var form = document.getElementById('myForm');

			// If the number input is hidden, set its value to the default value
			var numberInput = document.getElementById('numberInput');
			if (numberInput.style.display === 'none') {
				numberInput.value = 42; // Set your default value here
			}

			// Your additional form submission logic can go here

			// For example, submitting the form
			form.submit();
		}
	</script>
</body>

</html>